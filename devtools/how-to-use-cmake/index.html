<!doctype html>
<html>
<head>
    <title>如何使用cmake - How to Use Cmake // Realjf&#39;s blog</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.54.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="realjf" />
    <meta name="description" content="" />
    <base href="https://realjf.io/" />
    <link rel="stylesheet" href="https://realjf.io/css/main.min.c0ab408f1f4017773cd74b45b6f2c452dca7f0cadbfac8c8b7c70577fbf405b2.css" />
    <link rel="icon" href="./favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon"/>
    
    <script src="./js/highlight.pack.js"> </script>

    <link rel="stylesheet" href="./css/monokai-sublime.css">
    <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>

<header class="app-header">
    <a href="/"><img class="app-header-avatar" src="./avatar.jpg" /></a>
    <h1>Realjf&#39;s blog</h1>
    <p>认识自己，接受自己，忘记自己，追随自己的灵魂</p>
    <div class="app-header-social">
        
            <a target="_blank" href="https://github.com/realjf"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
            <a target="_blank" href="https://twitter.com/realjf2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg></a>
        
    </div>
    <div>
        <script type="text/javascript" src="//rf.revolvermaps.com/0/0/6.js?i=56j9sfhb0ei&amp;m=7&amp;c=e63100&amp;cr1=ffffff&amp;f=arial&amp;l=0&amp;bv=90&amp;lx=-420&amp;ly=420&amp;hi=20&amp;he=7&amp;hc=a8ddff&amp;rs=80" async="async"></script>
    </div>
</header>
<main class="app-container">
    <nav class="sidebar-nav">
    
    
            <a class="sidebar-nav-item" href="/" title="首页"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-home">
  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg> 首页</a>
    
            <a class="sidebar-nav-item" href="/posts/" title="归档"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-archive">
  <polyline points="21 8 21 21 3 21 3 8"></polyline><rect x="1" y="3" width="22" height="5"></rect><line x1="10" y1="12" x2="14" y2="12"></line>
</svg> 归档</a>
    
            <a class="sidebar-nav-item" href="/tags/" title="标签"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg> 标签</a>
    
            <a class="sidebar-nav-item" href="/categories/" title="分类"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-menu">
  <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
</svg> 分类</a>
    
</nav>
    <style>
    @media screen and (max-width: 500px) {
        .search{
             
            text-align: center;
        }

        .search input{
            width: 100%;
        }

        .search button{
             
        }
    }
     
    @media screen and (min-width: 320px) {
        .search{
            width: 100%;
            text-align: center;
        }

        .search input{
            width: 50%;
        }
    }

     
    .search{
        margin: auto;
    }

    .search input{
        outline: none;
        border: 2px solid #57cc8a;
        height: 40px;
    }
    .search .button {
        display: inline-block;
        position:relative;
    }
    .search .button button{
        outline: none;
        height: 40px;
        border: 0;
        width: 60px;
        background-color: #57A64A;
        margin: 0;
    }
    .search .icon{
        width: 22px;
        height: 22px;
    }
</style>
<div class="search">
    <input type="text" placeholder="search..." id="search-key" />
    <div class="button">
        <button onclick="search()">
            <svg t="1583982313567" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1271"
                 width="200" height="200" xmlns:xlink="http://www.w3.org/1999/xlink">
                <defs>
                    <style type="text/css"></style>
                </defs>
                <path d="M694.857143 475.428571q0-105.714286-75.142857-180.857142T438.857143 219.428571 258 294.571429 182.857143 475.428571t75.142857 180.857143T438.857143 731.428571t180.857143-75.142857T694.857143 475.428571z m292.571428 475.428572q0 29.714286-21.714285 51.428571t-51.428572 21.714286q-30.857143 0-51.428571-21.714286l-196-195.428571q-102.285714 70.857143-228 70.857143-81.714286 0-156.285714-31.714286t-128.571429-85.714286-85.714286-128.571428T36.571429 475.428571t31.714285-156.285714 85.714286-128.571428 128.571429-85.714286T438.857143 73.142857t156.285714 31.714286 128.571429 85.714286 85.714285 128.571428T841.142857 475.428571q0 125.714286-70.857143 228l196 196q21.142857 21.142857 21.142857 51.428572z"
                      p-id="1272" fill="#ffffff"></path>
            </svg>
        </button>
    </div>
</div>
<h1 id="search-tip" style="color: #57A64A;text-align: center;display: none;">搜索中，请稍后 ...</h1>
<br />
<div id="result"></div>

<script type="text/javascript">
    
    window.onload = function() {
        document.onkeydown = function(ev) {
            var event = ev || event
            if (event.keyCode === 13) {
                search()
            }
        }
    }

    
    function search() {
        var key = document.getElementById("search-key").value;
        if (key === "") {
            return;
        }
        

        
        document.getElementById("search-tip").innerText = "搜索中，请稍后 ...";
        document.getElementById("search-tip").style.display = "block";

        
        var el = document.getElementById('result');
        var childs = el.childNodes;
        for (var i = childs.length - 1; i >= 0; i--) {
            el.removeChild(childs[i]);
        }

        
        var xmltext = new XMLHttpRequest;
        xmltext.open("GET", "./index.xml", false);
        xmltext.send();
        var resp = xmltext.responseXML;
        var items = resp.getElementsByTagName("item");
        
        var i = 0;
        var haveResult = false;
        while (i < items.length) {
            var txt = items[i].getElementsByTagName("title")[0].innerHTML + items[i].getElementsByTagName("description")[0].innerHTML;
            var reg = new RegExp(key, "gi");
            if (txt.search(reg) > -1) {
                haveResult = true;
                var title = items[i].getElementsByTagName("title")[0].innerHTML;
                var link = items[i].getElementsByTagName("link")[0].innerHTML;
                var time = items[i].getElementsByTagName("pubDate")[0].innerHTML;
                var mark = items[i].getElementsByTagName("description")[0].innerHTML;
                addItem(title, link, time, mark)
            }
            i++;
        }
        if (!haveResult) {
            document.getElementById("search-tip").innerText = "搜索完毕，未发现结果 ...";
            document.getElementById("search-tip").style.display = "block";
        }
    }

    
    function addItem(title, link, time, mark) {
        document.getElementById("search-tip").style.display = "none";
        var tmpl = "<article class=\"post\" style=\"border-bottom: 1px solid #e6e6e6;\" >" +
            "<header class=\"post-header\">" +
            "<h1 class=\"post-title\"><a class=\"post-link\" href=\"" + link + "\" target=\"_blank\">" + title + "</a></h1>" +
            "<div class=\"post-meta\">" +
            " <span class=\"post-time\">" + time + "</span>" +
            "</div>" +
            " </header>" +
            "<div class=\"post-content\">" +
            "<div class=\"post-summary\">" + mark + "</div>" +
            "<div class=\"read-more\">" +
            "<a href=\"" + link + "\" class=\"read-more-link\" target=\"_blank\">阅读更多</a>" +
            "</div>" +
            " </div>" +
            "</article>"
        var div = document.createElement("div")
        div.innerHTML = tmpl;
        document.getElementById('result').appendChild(div)

    }
</script>
    
    <article class="post">
        <header class="post-header">
            <h1 class ="post-title">如何使用cmake - How to Use Cmake</h1>
            <div class="post-meta">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
                    Nov 4, 2020
                </div>
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
                    3 min read
                </div><div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
                        <a class="tag" href="https://realjf.io/tags/devtools/">Devtools</a><a class="tag" href="https://realjf.io/tags/cmake/">Cmake</a></div></div>
        </header>
        <div class="post-content">
            

<h2 id="准备">准备</h2>

<ul>
<li>cmake</li>
</ul>

<blockquote>
<p>下载地址：<a href="https://cmake.org/download/">https://cmake.org/download/</a></p>
</blockquote>

<h3 id="安装">安装</h3>

<p>具体的安装方法参照官网，这里不做赘述</p>

<h3 id="建议">建议</h3>

<p>cmake每次运行会产生大量中间文件，可以通过在项目根目录下创建build文件，然后运行cmake ../执行项目构建</p>

<h3 id="cmake命令行选项">cmake命令行选项</h3>

<h4 id="指定构建系统生成器-g">指定构建系统生成器： -G</h4>

<p>使用-G可以指定编译器，当前平台支持的编译器名称可以通过帮助手册查询cmake &ndash;help，</p>

<pre><code class="language-shell"># 使用vs2017构建工程
cmake -G &quot;Visual Studio 15 2017&quot; ../
# 使用MinGW 
cmake -G &quot;MinGW Makefiles&quot;
# 使用unix makefiles
cmake -G &quot;Unix Makefiles&quot;
</code></pre>

<h4 id="cmakecache-txt文件">CMakeCache.txt文件</h4>

<ul>
<li><p>当cmake第一次运行一个空的构建的时候，他会创建一个CMakeCache.txt文件，
文件里存放了一些可以用来制定工程的项目，比如：变量、选项等</p></li>

<li><p>对于同一变量，如果cache文件里面有设置，那么CMakeLists文件里就会优先使用Cache文件里面的同名变量。</p></li>

<li><p>CMakeLists里面通过设置了一个Cache里面没有的变量，那么就将这个变量的值写入到Cache里面</p></li>
</ul>

<h4 id="添加变量到cache文件中-d">添加变量到cache文件中： -D</h4>

<ul>
<li>注意：-D后面不能有空格，如：cmake -DCMAKE_BUILD_TYPE:STRING=Debug</li>
</ul>

<h4 id="从cache文件中删除变量-u">从Cache文件中删除变量：-U</h4>

<ul>
<li>此选项和-D功能相反，从Cache文件中删除变量，支持使用*和？通配符</li>
</ul>

<h4 id="cmake命令行模式-e">cmake命令行模式：-E</h4>

<ul>
<li>cmake提供了很多和平台无关的命令，在任何平台都可以使用：chdir, copy,copy_if_different等</li>
<li>可以使用：cmake -D help进行查询</li>
</ul>

<h4 id="打印运行的每一行cmake">打印运行的每一行cmake</h4>

<ul>
<li>命令行选项中：&ndash;trace，将打印运行的每一行cmake</li>
<li>命令：&ndash;trace-source=&ldquo;filename&rdquo; 就会打印出有关filename的执行</li>
</ul>

<h4 id="设置编译参数">设置编译参数</h4>

<ul>
<li>add_definitions (-DENABLED)，当在cmake里面添加该定义的时候，如果代码里面定义了#ifdef ENABLED #endif 相关的片段，此时代码里面这一块代码就会生效</li>
<li>//add_definitions(&ldquo;-Wall -ansi -pedantic -g&rdquo;)</li>
<li>该命令现已经被取代，使用：add_compile_definitions(WITH_OPENCV2)</li>
</ul>

<h4 id="设置默认值命令-option">设置默认值命令：option</h4>

<ul>
<li>option命令可以帮助我们设置一个自定义的宏，如：option(MY-MESSAGE &ldquo;this is my message&rdquo; ON)</li>
<li>第一个参数就是我们要设置的默认值的名字</li>
<li>第二个参数是对值的解释，类似于注释</li>
<li>第三个值是这个默认值的值，如果没有声明，cmake默认的是OFF</li>
<li>使用：设置好之后我们在命令行去使用的时候，也可以去给他设定值：cmake -DMY-MESSAGE=on ../</li>
<li>注意：使用的时候我们应该在值的前面加 &ldquo;D&rdquo;</li>
<li>这条命令可将MY-MESSAGE的值设置为on，通过这个值我们可以去触发相关的判断</li>
</ul>

<h3 id="cmake基础知识">cmake基础知识</h3>

<h4 id="最低版本">最低版本</h4>

<ul>
<li>每个cmake.txt的第一行都会写：cmake_minimum_required(VERSION 3.1)，该命令指定了cmake的最低版本是3.1</li>
<li>命令名称cmake_minimum_required不区分大小写</li>
<li>设置版本范围：cmake_minimum_required(VERSION 3.1&hellip;3.12)，该命令表示支持3.1至3.12之间的版本</li>
<li>判断cmake版本

<ul>
<li>if(${CMAKE_VERSION} VERSION_LESS 3.12)</li>
<li>cmake_policy(VERSION ${CMAKE_MAJOR_VERSION}.${CMAKE_MINOR_VERSION})</li>
<li>endif()</li>
<li>该命令表示：如果cmake版本小于3.12，则if块将为true，然后将设置为当前cmake版本；如果cmake版本高于3.12，if块为假，cmake_minimum_required将被正确执行</li>
<li>注意：如果需要支持非命令行windows版本，则需要加上else分支，如下：</li>
<li>cmake_minimum_required(VERSION 3.1)</li>
<li>if(${CMAKE_VERSION} VERSION_LESS 3.12)</li>
<li>cmake_policy(VERSION ${CMAKE_MAJOR_VERSION}.${CMAKE_MINOR_VERSION})</li>
<li>else()</li>
<li>cmake_policy(VERSION 3.12)</li>
<li>endif()</li>
</ul></li>
</ul>

<h4 id="设置生成项目名称">设置生成项目名称</h4>

<ul>
<li>使用的命令：project(MyProject)</li>
<li>表示我们生成的工程名字叫做：MyProject</li>
<li>命令还可以标识项目支持的语言，写法：project (MyProject[C][C++])，不过通常将后面的参数省掉，因为默认支持所有语言</li>
<li>使用该指令之后系统会自动创建两个变量：<projectname>_BINARY_DIR：二进制文件保存路径、<projectname>_SOURCE_DIR：源代码路径</li>
<li>执行：project(MyProject)，就是定义了一个项目的名称为：MyProject，对应的就会生成两个变量：_BINARY_DIR和_SOURCE_DIR，
但是cmake中其实已经有两个预定义的变量：PROJECT_BINARY_DIR和PROJECT_SOURCE_DIR</li>

<li><p>关于两个变量是否相同，涉及到是内部构建还是外部构建</p>

<ul>
<li>内部构建
<code>shell script
cmake ./
make
</code><br /></li>

<li><p>外部构建</p>

<pre><code class="language-shell">mkdir build
cd ./build
cmake ../
make
</code></pre></li>

<li><p>内部构建和外部构建的不同在于：cmake的工作目录不同，内部构建会将cmake生成的中间文件和可执行文件放在和项目同一个目录；外部构建的话，中间
文件和可执行文件会放在build目录</p></li>

<li><p>PROJECT_SOURCE_DIR和_SOURCE_DIR无论内部构建还是外部构建，指向的内容是一样的，都指向工程的根目录</p></li>

<li><p>PROJECT_BINARY_DIR和_BINARY_DIR指向的相同内容，内部构建的时候指向cmakelists.txt文件的目录，外部构建的，指向target编译的目录</p></li>
</ul></li>
</ul>

<h4 id="生成可执行文件">生成可执行文件</h4>

<ul>
<li><p>语法：add_executable(exename srcname)</p>

<ul>
<li>exename: 生成的可执行文件的名字</li>
<li>srcname: 依赖的源文件</li>
</ul></li>

<li><p>该命令指定生成exe的名字以及指出需要依赖的源文件的文件名</p></li>

<li><p>获取文件路径中的所有源文件</p>

<ul>
<li>命令：aux_source_directory(<dir> <variable>)</li>
<li>例子：aux_source_directory(. DIR_SRCS)，将当前目录下的源文件名字存放到变量DIR_SRCS里面，如果源文件比较多，直接用DIR_SRCS变量即可</li>
</ul></li>

<li><p>生成可执行文件：add_executable(Demo ${DIR_SRCS}),将生成的可执行文件命名为：Demo.exe</p></li>
</ul>

<h4 id="生成lib库">生成lib库</h4>

<ul>
<li>命令：add_library(libname [SHARED|STATIC|MODULE] [EXCLUDE_FROM_ALL] source1 source2 &hellip; sourceN)

<ul>
<li>libname:生成的库文件的名字</li>
<li>[SHARED|STATIC|MODULE]:生成库文件的类型（动态库|静态库|模块）</li>
<li>[EXCLUDE_FROM_ALL]:有这个参数表示该库不会被默认构建</li>
<li>source2 &hellip; sourceN：生成库依赖的源文件，如果源文件比较多，可以使用aux_source_directory命令获取路径下所有源文件</li>
<li>例子：add_library(ALib SHARE alib.cpp)
<br /></li>
</ul></li>
</ul>

<h4 id="添加头文件目录">添加头文件目录</h4>

<ul>
<li><p>命令1：target_include_directories(<target> [SYSTEM] [BEFORE] <INTERFACE|PUBLIC|PRIVATE> [items1&hellip;] [<INTERFACE|PUBLIC|PRIVATE> [items2&hellip;] &hellip;])
当我们添加子项目之后还需要设置一个include路径，例子：target_include_directories(RigelEditor PUBLIC ./include/rgeditor)，表示给RigelEditor这个子项目添加一个库文件的路径</p></li>

<li><p>命令2：include_directories([AFTER|BEFORE] [SYSTEM] dir1 [dir2&hellip;])</p>

<ul>
<li>参数解析：</li>
<li>[AFTER|BEFORE]:指定了要添加路径是添加到原有列表之前还是之后</li>
<li>[SYSTEM]：若指定了system参数，则把被包含的路径当做系统包含路径来处理</li>
<li>dir1 [dir2&hellip;]把这些路径添加到cmakelists及其子目录的cmakelists的头文件包含项目中，相当于g++选项中的-I的参数的作用
举个例子：include_directories(&ldquo;/opt/MATLAB/R2012a/extern/include&rdquo;)</li>
<li>两条指令的作用都是讲将include的目录添加到目录区别在于include_directories是cmake编译所有目标的目录进行添加，
target_include_directories是将cmake编译的指定的特定目标的包含目录进行添加
<br /></li>
</ul></li>
</ul>

<h4 id="添加需要链接的库文件路径">添加需要链接的库文件路径</h4>

<ul>
<li><p>命令1：target_link_libraries(<target> [item1 [item2 [&hellip;]]] [[debug|optimized|general] <item>] &hellip;)</p>

<ul>
<li>作用：为给定的目标设置链接时使用的库（设置要链接的库文件的名称）</li>
<li>eg：target_link_libraries(MyProject a b.a c.so) // 将若干库文件链接到hello中，target_link_libraries里的库文件的顺序符合gcc/g++链接顺序规则，
即：被依赖的库放在依赖他的库的后面，如果顺序有错，链接将会报错</li>
<li>关键字：debug对应于调试配置</li>
<li>关键字：optimized对应于所有其他的配置类型</li>
<li>关键字：general对应于所有的配置（该属性是默认值）
<br /></li>
</ul></li>

<li><p>命令2：link_libraries</p>

<ul>
<li>作用：给当前工程链接需要的库文件（全路径）</li>
<li>eg：link_libraries((&ldquo;/opt/MATLAB/R2012a/bin/glnxa64/libeng.so&rdquo;)//必须添加带名字的全路径)</li>
</ul></li>

<li><p>区别：link_libraries和target_link_libraries命令的区别：target_link_libraries可以给工程或者库文件设置其需要链接的库文件，
而且不需要填写全路径，但是link_libraries只能给工程添加依赖的库，而且必须添加全路径</p></li>

<li><p>添加需要链接的库文件目录</p>

<ul>
<li>命令：link_directories (添加需要链接的库文件目录)</li>
<li>语法：link_directories(directory1 directory2 ..)</li>
<li>例子：link_directories(&ldquo;/opt/MATLAB/R2012a/bin/glnxa64&rdquo;)
<br /></li>
</ul></li>

<li><p>指令的区别：指令的前缀带target，表示针对某一个目标进行设置，必须指明设置的目标；include_directories是在编译时用，指明.h文件的路径
link_directories是在链接时用的，指明链接库的路径;target_link_libraries是指明链接库的名字，也就是具体谁链接到哪个库。link_libraries不常用，
因为必须指明带文件名全路径</p></li>
</ul>

<h4 id="控制目标属性">控制目标属性</h4>

<ul>
<li><p>以上的几条命令的区分都是：是否带target前缀，在cmake里面，一个target有自己的属性集，如果我们没有显示的设置这些target的属性的话，
cmake默认是由相关的全局属性来填充target的属性，我们如果需要单独的设置target的属性，需要使用命令：set_target_properties()</p></li>

<li><p>命令格式
格式：set_target_properties(target1 target2 &hellip; PROPERTIES 属性名称1 值 属性名称2 值 &hellip;)</p></li>

<li><p>控制编译选项的属性是：COMPILE_FLAGS</p></li>

<li><p>控制连接选项的属性是：LINK_FLAGS</p></li>

<li><p>控制输出路径的属性：EXECUTABLE_OUTPUT_PATH (exe的输出路径)、LIBRARY_OUTPUT_PATH (库文件的输出路径)</p></li>

<li><p>举例：
命令：
set_target_properties(exe PROPERTIES LINK_FLAGS -static LINK_FLAGS_RELEASE -s)</p></li>

<li><p>这条指令会使得exe这个目标在所有的情况下都采用-static选项，而且在release build的时候-static -s选项。但是这个属性仅仅在exe这个target上面有效</p></li>
</ul>

<h4 id="变量和缓存">变量和缓存</h4>

<ul>
<li><p>局部变量</p>

<ul>
<li>CMakeLists.txt相当于一个函数，第一个执行的CMakeLists.txt相当于主函数，正常设置的变量不能跨域CMakeLists.txt文件，相当于局部变量只在当前函数域里面的作用一样</li>
<li>设置变量：set(MY_VARIABLE &ldquo;value&rdquo;)</li>
<li>变量的名称通常大写</li>
<li>访问变量：${MY_VARIABLE}
<br /></li>
</ul></li>

<li><p>缓存变量</p>

<ul>
<li>缓存变量就是cache变量，相当于全局变量，都是在第一个执行的CMakeLists.txt里面被设置的，不过在子项目的CMakeLists.txt文件里面也是可以修改这个变量的，
此时会影响父目录的CMakeLists.txt，这些变量用来配置整个工程，配置好之后对整个工程使用</li>
<li>设置缓存变量：set(MY_CACHE_VALUE &ldquo;cache_value&rdquo; CACHE INTERNAL &ldquo;THIS IS MY CACHE VALUE&rdquo;)
// THIS IS MY CACHE VALUE，这个字符串相当于对变量的描述说明，不能省略，但可以自己随便定义
<br /></li>
</ul></li>

<li><p>环境变量</p>

<ul>
<li>设置环境变量：set(ENV{variable_name} value)</li>
<li>获取环境变量：$ENV{variable_name}
<br /></li>
</ul></li>

<li><p>内置变量</p>

<ul>
<li>CMake里面包含大量的内置变量，和自定义的变量相同，常用的有以下：</li>
<li>CMAKE_C_COMPILER: 指定C编译器</li>
<li>CMAKE_CXX_COMPILER：指定C++编译器</li>
<li>EXECUTABLE_OUTPUT_PATH：指定可执行文件的存放路径</li>
<li>LIBRARY_OUTPUT_PATH：指定库文件的放置路径</li>
<li>CMAKE_CURRENT_SOURCE_DIR：当前处理的CMakeLists.txt所在的路径</li>
<li>CMAKE_BUILD_TYPE：控制构建的时候是Debug还是Release
命令：set(CMAKE_BUILD_TYPE Debug)</li>
<li>CMAKE_SOURCR_DIR:无论外部构建还是内部构建，都指的是工程的顶层目录</li>
<li>CMAKE_BINARY_DIR：内部构建指的是工程顶层目录，外部构建指的是工程发生编译的目录</li>
<li>CMAKE_CURRENT_LIST_LINE:输出这个内置变量所在的行
<br /></li>
</ul></li>

<li><p>缓存</p>

<ul>
<li>缓存就是之前提到的CMakeCache文件，参见：CMake命令行选项的设置
<br /></li>
</ul></li>
</ul>

<h3 id="cmake基本控制语法">CMake基本控制语法</h3>

<h4 id="if">if</h4>

<h5 id="基本语法">基本语法</h5>

<pre><code class="language-shell">if(expression)
    COMMAND1(ARGS...)
    COMMAND2(ARGS...)
    ...
else
    COMMAND1(ARGS...)
    COMMAND2(ARGS...)
endif (expression)

</code></pre>

<ul>
<li>if(expression),expression不为：空，0，N，NO，OFF，FALSE，NOTFOUND或<var>_NOTFOUND，为真</li>
<li>IF(not exp)，与上面相反</li>
<li>if(var1 AND var2)，var1且var2都为真，条件成立</li>
<li>if(var1 OR var2), var1或var2其中某一个为真，条件成立</li>
<li>if(COMMAND cmd)，如果cmd确实是命令并可调用，为真</li>
<li>if(EXISTS dir)如果目录存在，为真</li>
<li>if(EXISTS file)如果文件存在，为真</li>
<li>if(file1 IS_NEWER_THAN file2)，当file1比file2新，或file1/file2中有一个不存在时为真，文件名需使用全路径</li>
<li>if(IS_DIRECTORY dir) 当dir是目录时，为真</li>
<li>if(DEFINED var)如果变量被定义，为真</li>
<li>if(string MATCHES regex)当给定变量或字符串能匹配正则表达式regex时，为真</li>
</ul>

<h5 id="数字表达式">数字表达式</h5>

<ul>
<li>if(var LESS number),var小于number为真</li>
<li>if(var GREATER number)，var大于number为真</li>
<li>if(var EQUAL number)，var等于number为真</li>
</ul>

<h5 id="字母表顺序比较">字母表顺序比较</h5>

<ul>
<li>if(var1 STRLESS var2)，var1字母表顺序小于var2为真</li>
<li>if(var1 STRGREATER var2)，var1字母表顺序大于var2为真</li>
<li>if(var1 STREQUAL var2)，var1和var2字母顺序相等为真</li>
</ul>

<h4 id="while">while</h4>

<h5 id="语法结构">语法结构</h5>

<pre><code class="language-shell">WHILE(condition)
    COMMAND1(ARGS...)
    COMMAND2(ARGS...)
    ...
ENDWHILE(condition)
</code></pre>

<h4 id="foreach">foreach</h4>

<h5 id="列表循环">列表循环</h5>

<ul>
<li>语法
<code>shell script
FOREACH(loop_var arg1 arg2...)
COMMAND1(ARGS...)
COMMAND2(ARGS...)
...
ENDFOREACH(loop_var)
</code></li>
<li>例子
<code>shell script
AUX_SOURCE_DIRECTORY(. SRC_LIST)
FOREACH(F ${SRC_LIST})
MESSAGE(${F})
ENDFOREACH(F)
</code></li>
</ul>

<h5 id="范围循环">范围循环</h5>

<ul>
<li><p>语法</p>

<pre><code class="language-shell">FOREACH(loop_var RANGE total)
COMMAND1(ARGS...)
COMMAND2(ARGS...)
...
ENDFOREACH(loop_var)
</code></pre>

<h5 id="范围步进循环">范围步进循环</h5></li>

<li><p>语法</p>

<pre><code class="language-shell">FOREACH(loop_var RANGE start stop [step])
COMMAND1(ARGS...)
COMMAND2(ARGS...)
...
ENDFOREACH(loop_var)
</code></pre></li>
</ul>

<h3 id="构建规范以及构建属性">构建规范以及构建属性</h3>

<h4 id="用于指定构建规则以及程序使用要求的指令-target-include-directories-target-compile-definitions-target-compile-options">用于指定构建规则以及程序使用要求的指令：target_include_directories(),target_compile_definitions(),target_compile_options()</h4>

<h4 id="指令格式">指令格式</h4>

<ul>
<li>target_include_directories(<target> [SYSTEM] [BEFORE] <INTERFACE|PUBLIC|PRIVATE> [items1&hellip;] [<INTERFACE|PUBLIC|PRIVATE> [items2&hellip;]&hellip;])
&gt; include的头文件的查找目录，也就是Gcc的[-Idir&hellip;]选项</li>
<li>target_compile_definitions(<target> <INTERFACE|PUBLIC|PRIVATE> [items1&hellip;][<INTERFACE|PUBLIC|PRIVATE> [items2&hellip;]&hellip;])
&gt; 通过命令行定义的宏变量</li>

<li><p>target_compile_options(<target> [BEFORE] <INTERFACE|PUBLIC|PRIVATE> [items1&hellip;] [<INTERFACE|PUBLIC|PRIVATE> [items2&hellip;]&hellip;])
&gt; gcc其他的一些编译选项指定，比如-fPIC</p></li>

<li><p>-fPIC选项说明
说明：-fPIC作用于编译阶段，告诉编译器产生与位置无关代码，则产生的代码中，没有绝对地址，全部使用相对地址，故而代码可以被加载器加载到内存的任意位置，都可以正确执行。
这正是共享库所要求的，共享库被加载时，在内存的位置不是固定的</p></li>

<li><p>-Idir选项说明
说明：在你是用<strong>#include &ldquo;file&rdquo;</strong>的时候，gcc/g++会先在当前目录查找你所制定的头文件，如果没有找到，他会到缺省的头文件目录找，
如果使用-I制定了目录，它会先在你所制定的目录查找，然后再按常规的顺序去找</p></li>
</ul>

<h4 id="以上的三个命令会生成include-directories-compile-definitions-compile-options变量的值-或者interface-include-directories-interface-compile-definitions-interface-compile-options的值">以上的三个命令会生成INCLUDE_DIRECTORIES,COMPILE_DEFINITIONS,COMPILE_OPTIONS变量的值，或者INTERFACE_INCLUDE_DIRECTORIES,INTERFACE_COMPILE_DEFINITIONS,INTERFACE_COMPILE_OPTIONS的值</h4>

<h4 id="这三个命令都有三种可选模式-private-public-interface">这三个命令都有三种可选模式，PRIVATE,PUBLIC。INTERFACE.</h4>

<ul>
<li>PRIVATE模式仅填充不是接口的目标属性；</li>
<li>INTERFACE模式仅填充接口目标的属性.</li>
<li>PUBLIC模式填充这两种的目标属性</li>
</ul>

<h3 id="宏和函数">宏和函数</h3>

<h4 id="区别">区别</h4>

<ul>
<li>函数有范围，而宏没有，如果希望函数设置的变量在函数的外部也可以看见，就需要使用PARENT_SCOPE来修饰，但是函数对于变量的控制会比较好，不会有变量泄漏</li>
<li>函数很难将计算结果传出来，使用宏就可以将一些简单的传出来</li>
</ul>

<h5 id="宏">宏</h5>

<pre><code class="language-shell">macro([arg1 [arg2 [arg3 ...] ]])
    COMMAND1(ARGS...)
    COMMAND2(ARGS...)
    ...
endmacro()
</code></pre>

<h5 id="函数">函数</h5>

<pre><code class="language-shell">function([arg1 [arg2 [arg3 ...] ]])
    COMMAND1(ARGS...)
    COMMAND2(ARGS...)
    ...
endfunction()
</code></pre>

<h3 id="和其他文件的交互">和其他文件的交互</h3>

<blockquote>
<p>暂略</p>
</blockquote>

<h3 id="如何构建项目">如何构建项目</h3>

<h4 id="工程目录结构">工程目录结构</h4>

<pre><code class="language-shell">|--- lib
      |--- libA.c
      |--- libB.c
      |--- CMakeLists.txt
|--- include
      |--- includeA.h
      |--- includeB.h
      |--- CMakeLists.txt
|--- main.c
|--- CMakeLists.txt

</code></pre>

<ul>
<li><p>第一个CMakeLists.txt
```shell script</p>

<h1 id="项目名称">项目名称</h1>

<p>project(main)</p></li>
</ul>

<h1 id="需要的cmake最低版本">需要的cmake最低版本</h1>

<p>cmake_minium_required(VERSUIB 2.8)</p>

<h1 id="将当前目录下的源文件名都赋给dir-src目录">将当前目录下的源文件名都赋给DIR_SRC目录</h1>

<p>aux_source_directories(. DIR_SRC)</p>

<h1 id="添加include目录">添加include目录</h1>

<p>include_directories(include)</p>

<p>#生成可执行文件
add_executable(main ${DIR_SRC})</p>

<p>#添加子目录
add_subdirectories(lib)</p>

<p>#将生成的文件与动态库相连
target_link_libraries(main test)</p>

<h1 id="test是lib目录里生成的">test是lib目录里生成的</h1>

<pre><code>- lib目录下的CMakeLists

内容如下：
```shell script
# 将当前的源文件名字都添加到DIR_LIB变量下
aux_source_directory(. DIR_LIB)

# 生成库文件命名为test
add_libraries(test ${DIR_LIB})
</code></pre>

<ul>
<li>include目录的CMakeLists可以为空，因为我们已经将include目录包含在第一层的文件里面</li>
</ul>

<h3 id="在构建时运行的命令">在构建时运行的命令</h3>

<h4 id="find-package-查找链接库">find_package：查找链接库</h4>

<p>如果编译的过程使用了外部的库，事先并不知道其头文件和链接库的位置，得在编译命令中加上包含外部库的查找路径，cmake中使用find_package方法</p>

<h5 id="find-package-命令查找-cmake的顺序">find_package()命令查找***.cmake的顺序</h5>

<ul>
<li>介绍这个命令之前，首先得介绍一个变量：CMAKE_MODULE_PATH

<ul>
<li>工程比较大的时候，会创建自己的cmake模块，需要告诉cmake这个模块在哪里，cmake就是通过CMAKE_MODULE_PATH这个变量来获取模块路径的</li>
<li>我们使用set来设置模块的路径：set(CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/cmake)</li>
</ul></li>
<li>如果上面的没有找到，就会在../.cmake/packages或者../usr/local/share/中的包目录中查找：&lt;库名字大写&gt;Config.cmake或者&lt;库名字小写&gt;-config.cmake</li>
<li>如果找到这个包，则可以通过在工程的顶层目录中的CMakeLists.txt中添加：include_directories(<Name>_INCLUDE_DIRS)来包含库的头文件，使用命令：target_link_libraries(源文件 <NAME>_LIBRARIES)将源文件以及库文件链接起来</li>
<li>无论哪种方式，只要找到<strong><em>.cmake文件，</em></strong>.cmake里面都会定义下面的这些变量
<code>shell script
&lt;NAME&gt;_FOUND
&lt;NAME&gt;_INCLUDE_DIRS or &lt;NAME&gt;_INCLUDES
&lt;NAME&gt;_LIBRARIES or &lt;NAME&gt;_LIBRARIES or &lt;NAME&gt;_LIBS
&lt;NAME&gt;_DEFINITIONS
</code></li>
<li>cmake中使用：cmake &ndash;help-module-list命令来查看当前cmake中有哪些支持的模块</li>
</ul>

<h5 id="find-package命令参数">find_package命令参数</h5>

<pre><code class="language-shell">FIND_PACKAGE(&lt;name&gt; [version] [EXACT] [QUIET] [NO_MODULE] [[REQUIRED|COMPONENTS] [components...]])
</code></pre>

<ul>
<li>version 需要一个版本号，给出这个参数而没有给出EXACT，那就是找到和给出的这个版本号相兼容的就符合条件</li>
<li>EXACT: 要求版本号必须和version给出的精确匹配</li>
<li>QUIET: 会禁掉查找的包没有被发现的警告信息，对应于Find<Name>.cmake模块里面的NAME_FIND_QUIETLY变量</li>
<li>NO_MODULE: 给出该指令后，cmake将直接跳过module模式的查找，直接使用config模式查找</li>
<li>REQUIRED: 该选项表示如果没有找到需要的包就会停止并且报错</li>
<li>COMPONENTS: 在REQUIRED选项之后，或者如果没有指定REQUIRED选项但是指定了COMPONENTS选项，在COMPONENTS后面就可以列出一些与包相关部分组件的清单</li>
</ul>

<h3 id="如何添加c-项目中的常用选项">如何添加C++项目中的常用选项</h3>

<h4 id="如何激活c-11功能">如何激活c++11功能</h4>

<pre><code class="language-shell"># 语法
target_compile_features(&lt;target&gt; &lt;PRIVATE|PUBLIC|INTERFACE&gt; &lt;feature&gt; [...])
</code></pre>

<ul>
<li>target_compile_features(<project_name> PUBLIC cxx_std_11)</li>
<li>参数target必须是由：add_executable或者add_library生成的目标</li>
<li>另一种支持c++标准的方法
```shell script
#设置c++标准级别
set(CMAKE_CXX_STANDARD 11)</li>
</ul>

<p>#告诉CMake使用他
set(CMAKE_CXX_STANDARD_REQUIRED ON)</p>

<h1 id="确保-std-c-11">确保-std=C++11</h1>

<p>set(CMAKE_CXX_EXTENSIONS OFF)</p>

<pre><code>
#### CMake的过程间优化
- 如果编译器不支持，就会将设置的过程间优化标记为错误，可以使用命令：
check_ipo_supported()来查看
```shell script
#检测编译器是否支持过程间优化
check_ipo_supported(RESULT result)

#如果不支持
if(result)
    #为工程foo设置过程间优化
    set_target_properties(foo PROPERTIES INTERPROCEDURAL_OPTIMIZATION TRUE)
endif()
</code></pre>

        </div>
        <div id="disqus_thread"></div>
<script>

    

    

    (function() { 
        var d = document, s = d.createElement('script');
        s.src = 'https://realjf.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </article>
    

    <div class="article-related">
        <hr/>
        <fieldset>
            <legend>相关阅读推荐（See Also）</legend>
            <ul>
                
                    <li><a href="/devtools/vagrantfile/">Vagrantfile</a></li>
                
                    <li><a href="/devtools/install-vagrant/">安装vagrant Install Vagrant</a></li>
                
                    <li><a href="/devtools/cmake-tutorial/">Cmake 使用基本教程</a></li>
                
                    <li><a href="/devtools/makefile-rule/">Makefile 基本语法和规则</a></li>
                
                    <li><a href="/devtools/sublimetext/">Sublimetext debian安装与常用插件配置</a></li>
                
            </ul>
        </fieldset>
    </div>


    
<aside class="aside-menu">
    <div class="aside-bar-icon">
        <i class="fa fa-list-alt"></i>
    </div>
    <ul>
        
        
            
                <li>
                    <a href="/" title="首页">
                        
                        <span>首页</span>
                    </a>
                </li>
            
        
            
                <li>
                    <a href="/posts/" title="归档">
                        
                        <span>归档</span>
                    </a>
                </li>
            
        
            
                <li>
                    <a href="/tags/" title="标签">
                        
                        <span>标签</span>
                    </a>
                </li>
            
        
            
                <li>
                    <a href="/categories/" title="分类">
                        
                        <span>分类</span>
                    </a>
                </li>
            
        
    </ul>
</aside>

    

</main>

<div class="app-footer">
    <span>
  powered by <a target="_blank" href="https://gohugo.io">hugo</a> &nbsp;&nbsp;&nbsp;
   &copy; 2019 - 2020 <a href="https://realjf.io">realjf.io</a>
</span>
</div>
<script id="dsq-count-scr" src="//realjf.disqus.com/count.js" async></script>
<script type="text/javascript" src="./js/highlight.min.js"></script>
</body>
</html>
