---
title: "C++之内存模型 Memory Model"
date: 2020-04-27T16:44:23+08:00
keywords: ["内存模型"]
categories: ["cpp"]
tags: ["内存模型"]
series: [""]
draft: true
toc: false
related:
  threshold: 80
  includeNewer: false
  toLower: false
  indices:
  - name: keywords
    weight: 100
  - name: tags
    weight: 90
  - name: categories
    weight: 50
  - name: date
    weight: 10
---

C++使用三种不同方案（C++11是四种）来存储数据：

- 自动存储持续性 在函数定义中声明的变量（包括函数参数）的持续性为自动的。他们在程序开始执行其所属的函数或代码块时被创建，在执行完函数或代码块时，他们使用的内存将被释放。
- 静态存储持续性 在函数定义外定义的变量和使用关键字static定义的变量存储的持续性都为静态，他们在程序整个运行过程中都存在。
- 线程储存持续性（C++11）多核处理器很常见，如果变量是使用关键字thread_local声明的，则其生命周期与所属的线程一样长。
- 动态存储持续性 用new运算符分配的内存将一直存在，知道使用delete运算符将其释放或程序结束位置。这种内存的存储持续性为动态，有时被称为自由存储或堆

> 作用域描述了名称在文件的多大范围可见
> 链接性描述了名称如何在不同单元间共享。链接性为外部的名称可在文件间共享，链接性为内存的名称只能由一个文件中的函数共享。自动变量的名称没有链接性，因为它们不能共享。


### 自动存储持续性
在默认情况下，在函数中声明的函数参数和变量的存储持续性为自动，作用域为局部，没有链接性。

#### 自动变量和栈
由于自动变量的数目随函数的开始和结束而增减，因此程序常留出一段内存对自动变量进行管理，通常将其视为栈。

栈是后进先出的，这种设计简化了参数传递。函数调用将其参数的值放在栈顶，然后重新设置栈顶指针，被调用的函数根据其形参描述来确定每个参数的地址。

### 静态持续变量

c++为静态存储持续性变量提供了3种链接性：
- 外部链接性（可在其他文件中访问）、
- 内部链接性（只能在当前文件中访问）
- 无连接性（只能在当前函数或代码中访问）

这三种链接性都在整个程序执行期间存在。

如果没有显示地初始化静态变量，编译器将把它设置为0.


### 动态分配

