---
title: "C++智能指针详解（Smart Pointer）"
date: 2020-04-17T11:21:57+08:00
keywords: ["智能指针"]
categories: ["cpp"]
tags: ["智能指针"]
series: [""]
draft: true
toc: false
related:
  threshold: 80
  includeNewer: false
  toLower: false
  indices:
  - name: keywords
    weight: 100
  - name: tags
    weight: 90
  - name: categories
    weight: 50
  - name: date
    weight: 10
---

### 智能指针
智能指针在C++11版本之后提供，包含在头文件<memory>中，包括三种：
- shared_ptr
- unique_ptr
- weak_ptr

### 智能指针的作用
由于C++没有垃圾回收机制，一切内存堆操作都是程序员自己管理，但对于程序员来说管理堆不胜麻烦，稍有不慎忘记释放就会造成内存泄露最终导致内存溢出等问题。
而智能指针则能有效避免此类问题发生。

智能指针通过对普通指针进行类封装，使其表现的跟普通指针类似的行为。

#### shared_ptr指针
shared_ptr 使用引用计数，每一个shared_ptr的拷贝都指向相同的内存地址，
 

#### unique_ptr指针


#### weak_ptr指针


### 智能指针的原理
智能指针：实际指行为类似于指针的类对象 ，它的一种通用实现方法是采用引用计数的方法。

- 1.智能指针将一个计数器与类指向的对象相关联，引用计数跟踪共有多少个类对象共享同一指针。
- 2.每次创建类的新对象时，初始化指针并将引用计数置为1；
- 3.当对象作为另一对象的副本而创建时，拷贝构造函数拷贝指针并增加与之相应的引用计数；
- 4.对一个对象进行赋值时，赋值操作符减少左操作数所指对象的引用计数（如果引用计数为减至0，则删除对象），并增加右操作数所指对象的引用计数；这是因为左侧的指针指向了右侧指针所指向的对象，因此右指针所指向的对象的引用计数+1；
- 5.调用析构函数时，构造函数减少引用计数（如果引用计数减至0，则删除基础对象）。
- 6.实现智能指针有两种经典策略：一是引入辅助类，二是使用句柄类。这里主要讲一下引入辅助类的方法


