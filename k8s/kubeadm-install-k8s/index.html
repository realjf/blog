<!doctype html>
<html>
<head>
    <title>使用kubeadm工具安装 kubernetes Use Kubeadm Install K8s // Realjf&#39;s blog</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.83.1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="realjf" />
    <meta name="description" content="" />
    <base href="https://realjf.io/" />
    <link rel="stylesheet" href="https://realjf.io/css/main.min.44025d9d47fd12ea5349430ff0bc376438d82dd061f2f595e1fbd470d8de30d4.css" />
    <link rel="icon" href="./favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon"/>
    
    <script src="./js/highlight.pack.js"> </script>

    <link rel="stylesheet" href="./css/monokai-sublime.css">
    <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>

<header class="app-header">
    <a href="/"><img class="app-header-avatar" src="./avatar.jpg" /></a>
    <h1>Realjf&#39;s blog</h1>
    <p>认识自己，接受自己，忘记自己，追随自己的灵魂</p>
    <div class="app-header-social">
        
            <a target="_blank" href="https://github.com/realjf"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
            <a target="_blank" href="https://twitter.com/realjf2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg></a>
        
    </div>
    <div>
        <script type="text/javascript" src="//rf.revolvermaps.com/0/0/6.js?i=56j9sfhb0ei&amp;m=7&amp;c=e63100&amp;cr1=ffffff&amp;f=arial&amp;l=0&amp;bv=90&amp;lx=-420&amp;ly=420&amp;hi=20&amp;he=7&amp;hc=a8ddff&amp;rs=80" async="async"></script>
    </div>
</header>
<main class="app-container">
    <nav class="sidebar-nav">
    
    
            <a class="sidebar-nav-item" href="/" title="首页"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-home">
  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg> 首页</a>
    
            <a class="sidebar-nav-item" href="/posts/" title="归档"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-archive">
  <polyline points="21 8 21 21 3 21 3 8"></polyline><rect x="1" y="3" width="22" height="5"></rect><line x1="10" y1="12" x2="14" y2="12"></line>
</svg> 归档</a>
    
            <a class="sidebar-nav-item" href="/tags/" title="标签"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg> 标签</a>
    
            <a class="sidebar-nav-item" href="/categories/" title="分类"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-menu">
  <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
</svg> 分类</a>
    
</nav>
    <style>
    @media screen and (max-width: 500px) {
        .search{
             
            text-align: center;
        }

        .search input{
            width: 100%;
        }

        .search button{
             
        }
    }
     
    @media screen and (min-width: 320px) {
        .search{
            width: 100%;
            text-align: center;
        }

        .search input{
            width: 50%;
        }
    }

     
    .search{
        margin: auto;
    }

    .search input{
        outline: none;
        border: 2px solid #57cc8a;
        height: 40px;
    }
    .search .button {
        display: inline-block;
        position:relative;
    }
    .search .button button{
        outline: none;
        height: 40px;
        border: 0;
        width: 60px;
        background-color: #57A64A;
        margin: 0;
    }
    .search .icon{
        width: 22px;
        height: 22px;
    }
</style>
<div class="search">
    <input type="text" placeholder="search..." id="search-key" />
    <div class="button">
        <button onclick="search()">
            <svg t="1583982313567" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1271"
                 width="200" height="200" xmlns:xlink="http://www.w3.org/1999/xlink">
                <defs>
                    <style type="text/css"></style>
                </defs>
                <path d="M694.857143 475.428571q0-105.714286-75.142857-180.857142T438.857143 219.428571 258 294.571429 182.857143 475.428571t75.142857 180.857143T438.857143 731.428571t180.857143-75.142857T694.857143 475.428571z m292.571428 475.428572q0 29.714286-21.714285 51.428571t-51.428572 21.714286q-30.857143 0-51.428571-21.714286l-196-195.428571q-102.285714 70.857143-228 70.857143-81.714286 0-156.285714-31.714286t-128.571429-85.714286-85.714286-128.571428T36.571429 475.428571t31.714285-156.285714 85.714286-128.571428 128.571429-85.714286T438.857143 73.142857t156.285714 31.714286 128.571429 85.714286 85.714285 128.571428T841.142857 475.428571q0 125.714286-70.857143 228l196 196q21.142857 21.142857 21.142857 51.428572z"
                      p-id="1272" fill="#ffffff"></path>
            </svg>
        </button>
    </div>
</div>
<h1 id="search-tip" style="color: #57A64A;text-align: center;display: none;">搜索中，请稍后 ...</h1>
<br />
<div id="result"></div>

<script type="text/javascript">
    
    window.onload = function() {
        document.onkeydown = function(ev) {
            var event = ev || event
            if (event.keyCode === 13) {
                search()
            }
        }
    }

    
    function search() {
        var key = document.getElementById("search-key").value;
        if (key === "") {
            return;
        }
        

        
        document.getElementById("search-tip").innerText = "搜索中，请稍后 ...";
        document.getElementById("search-tip").style.display = "block";

        
        var el = document.getElementById('result');
        var childs = el.childNodes;
        for (var i = childs.length - 1; i >= 0; i--) {
            el.removeChild(childs[i]);
        }

        
        var xmltext = new XMLHttpRequest;
        xmltext.open("GET", "./index.xml", false);
        xmltext.send();
        var resp = xmltext.responseXML;
        var items = resp.getElementsByTagName("item");
        
        var i = 0;
        var haveResult = false;
        while (i < items.length) {
            var txt = items[i].getElementsByTagName("title")[0].innerHTML + items[i].getElementsByTagName("description")[0].innerHTML;
            var reg = new RegExp(key, "gi");
            if (txt.search(reg) > -1) {
                haveResult = true;
                var title = items[i].getElementsByTagName("title")[0].innerHTML;
                var link = items[i].getElementsByTagName("link")[0].innerHTML;
                var time = items[i].getElementsByTagName("pubDate")[0].innerHTML;
                var mark = items[i].getElementsByTagName("description")[0].innerHTML;
                addItem(title, link, time, mark)
            }
            i++;
        }
        if (!haveResult) {
            document.getElementById("search-tip").innerText = "搜索完毕，未发现结果 ...";
            document.getElementById("search-tip").style.display = "block";
        }
    }

    
    function addItem(title, link, time, mark) {
        document.getElementById("search-tip").style.display = "none";
        var tmpl = "<article class=\"post\" style=\"border-bottom: 1px solid #e6e6e6;\" >" +
            "<header class=\"post-header\">" +
            "<h1 class=\"post-title\"><a class=\"post-link\" href=\"" + link + "\" target=\"_blank\">" + title + "</a></h1>" +
            "<div class=\"post-meta\">" +
            " <span class=\"post-time\">" + time + "</span>" +
            "</div>" +
            " </header>" +
            "<div class=\"post-content\">" +
            "<div class=\"post-summary\">" + mark + "</div>" +
            "<div class=\"read-more\">" +
            "<a href=\"" + link + "\" class=\"read-more-link\" target=\"_blank\">阅读更多</a>" +
            "</div>" +
            " </div>" +
            "</article>"
        var div = document.createElement("div")
        div.innerHTML = tmpl;
        document.getElementById('result').appendChild(div)

    }
</script>
    
    <article class="post">
        <header class="post-header">
            <h1 class ="post-title">使用kubeadm工具安装 kubernetes Use Kubeadm Install K8s</h1>
            <div class="post-meta">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
                    Apr 20, 2021
                </div>
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
                    6 min read
                </div><div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
                        <a class="tag" href="https://realjf.io/tags/k8s/">k8s</a><a class="tag" href="https://realjf.io/tags/kubeadm/">kubeadm</a></div></div>
        </header>
        <div class="post-content">
            <h3 id="环境准备">环境准备</h3>
<ul>
<li>centos-7 x86_64 2009</li>
<li>vmware 16 虚拟机</li>
<li>kubernetes: v1.21.0</li>
<li>docker-ce: 20.10.5</li>
<li>cpu最少：4核</li>
<li>内存最少：4GB</li>
<li>swap：禁用</li>
<li>最小磁盘：100GB</li>
</ul>
<p>请先在vmware虚拟机中安装好centos7,并且关闭防火墙和selinux</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># 关闭防火墙</span>
sed -ri <span style="color:#e6db74">&#39;s#(SELINUX=).*#\1disabled#&#39;</span> /etc/selinux/config
setenforce <span style="color:#ae81ff">0</span>
systemctl disable firewalld
systemctl stop firewalld

<span style="color:#75715e"># 禁用swap</span>
<span style="color:#75715e"># 注释/etc/fstab关于swap的配置</span>
<span style="color:#75715e"># 然后执行如下命令</span>
echo vm.swappiness<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt; /etc/sysctl.conf 
<span style="color:#75715e"># 重启</span>
reboot
<span style="color:#75715e"># 查看是否禁用</span>
free -m
<span style="color:#75715e"># 如果swap全部是0表示成功</span>
</code></pre></div><p>docker-ce安装</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># 安装yum源</span>
yum install -y wget <span style="color:#f92672">&amp;&amp;</span> wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo
<span style="color:#75715e"># 安装docker</span>
yum install docker-ce
<span style="color:#75715e"># 设置开机自启</span>
systemctl enable docker <span style="color:#f92672">&amp;&amp;</span> systemctl start docker
docker version
</code></pre></div><h3 id="第一步安装kubeadm和相关工具">第一步：安装kubeadm和相关工具</h3>
<p>官网yum源：https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64。
如果无法访问，可以使用国内阿里云的yum源，地址是：http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
，具体的yum配置文件/etc/yum.repos.d/kubernetes.repo内容如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>kubernetes<span style="color:#f92672">]</span>
name<span style="color:#f92672">=</span>Kubernetes Repository
baseurl<span style="color:#f92672">=</span>http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
gpgcheck<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</code></pre></div><p>然后运行安装kubeadm命令：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">yum install -y kubelet kubeadm --disableexcludes<span style="color:#f92672">=</span>kubernetes
</code></pre></div><p>本次实验安装的版本分别如下：</p>
<ul>
<li>kubeadm 1.21.0</li>
<li>kubelet 1.21.0</li>
<li>kubectl 1.21.0</li>
<li>kubernetes-cni 0.8.7</li>
</ul>
<p>然后在启动docker服务和kubelet服务</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">systemctl enable docker <span style="color:#f92672">&amp;&amp;</span> systemctl start docker
systemctl enable kubelet <span style="color:#f92672">&amp;&amp;</span> systemctl start kubelet
</code></pre></div><h4 id="kubeadm-config配置">kubeadm config配置</h4>
<p>kubeadm config子命令解释</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubeadm config upload from-file <span style="color:#75715e"># 由配置文件上传到集群中生成ConfigMap</span>
kubeadm config upload from-flags <span style="color:#75715e"># 由配置参数生成ConfigMap</span>
kubeadm config view <span style="color:#75715e"># 查看当前集群中的配置值</span>
kubeadm config print init-defaults <span style="color:#75715e"># 输出kubeadm init默认参数文件的内容</span>
kubeadm config print join-defaults <span style="color:#75715e"># 输出kubeadm join默认参数文件的内容</span>
kubeadm config migrate <span style="color:#75715e"># 在新旧版本之间进行配置转换</span>
kubeadm config images list <span style="color:#75715e"># 列出所需的镜像列表</span>
kubeadm config images pull <span style="color:#75715e"># 拉取镜像到本地</span>
</code></pre></div><p>可以执行kubeadm config print init-defaults取得默认的初始化参数文件：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubeadm config print init-defaults &gt; init.default.yaml
</code></pre></div><p>对生成的文件进行编辑，可以按需生成合适的配置。如，若需要定制镜像仓库的地址，以及pod的地址范围，可以使用如下配置：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">...
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">InitConfiguration</span>
<span style="color:#f92672">localAPIEndpoint</span>:
  <span style="color:#75715e"># 修改ip地址为本机ip地址</span>
  <span style="color:#f92672">advertiseAddress</span>: <span style="color:#ae81ff">192.168.37.150</span>
  <span style="color:#f92672">bindPort</span>: <span style="color:#ae81ff">6443</span>
...
<span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kubeadm.k8s.io/v1beta2</span>
<span style="color:#f92672">imageRepository</span>: <span style="color:#ae81ff">registry.aliyuncs.com/google_containers</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterConfiguration</span>
<span style="color:#f92672">kubernetesVersion</span>: <span style="color:#ae81ff">1.21.0</span>
<span style="color:#f92672">networking</span>:
  <span style="color:#f92672">dnsDomain</span>: <span style="color:#ae81ff">cluster.local</span>
  <span style="color:#f92672">serviceSubnet</span>: <span style="color:#ae81ff">10.96.0.0</span><span style="color:#ae81ff">/12</span>
  <span style="color:#75715e"># 新增pod地址范围</span>
  <span style="color:#f92672">podSubnet</span>: <span style="color:#e6db74">&#34;192.168.0.0/16&#34;</span>
<span style="color:#f92672">scheduler</span>: {}
</code></pre></div><p>这里使用国内阿里云的镜像，
将上面的内容保存为init-config.yaml备用</p>
<h4 id="下载kubernetes的相关镜像">下载kubernetes的相关镜像</h4>
<p>为了从国内的镜像托管站点获得镜像加速支持，建议修改docker的配置文件，增加Registry Mirror参数，
将镜像配置写入配置参数中，例如：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">echo <span style="color:#e6db74">&#39;{&#34;registry-mirrors&#34;:[&#34;https://registry.docker-cn.com&#34;]}&#39;</span> &gt; /etc/docker/daemon.json
<span style="color:#75715e"># 然后重启docker服务</span>
</code></pre></div><p>使用config images pull 子命令下载所需的镜像，如：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubeadm config images pull --config<span style="color:#f92672">=</span>init-config.yaml
</code></pre></div><p>拉取到最后报错：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">failed to pull image <span style="color:#e6db74">&#34;registry.aliyuncs.com/google_containers/coredns/coredns:v1.8.0&#34;</span>: output: Error response from daemon: manifest <span style="color:#66d9ef">for</span> registry.aliyuncs.com/google_containers/coredns/coredns:v1.8.0 not found: manifest unknown: manifest unknown
</code></pre></div><p>解决方法是直接使用docker拉取，然后打tag</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># 先拉取官方镜像</span>
docker pull coredns/coredns:1.8.0
<span style="color:#75715e"># 然后打上tag</span>
docker tag docker.io/coredns/coredns:1.8.0 registry.aliyuncs.com/google_containers/coredns/coredns:v1.8.0
</code></pre></div><p>使用kubeadm config images list &ndash;config=init-config.yaml可以查看需要的镜像文件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">registry.aliyuncs.com/google_containers/kube-apiserver:v1.21.0
registry.aliyuncs.com/google_containers/kube-controller-manager:v1.21.0
registry.aliyuncs.com/google_containers/kube-scheduler:v1.21.0
registry.aliyuncs.com/google_containers/kube-proxy:v1.21.0
registry.aliyuncs.com/google_containers/pause:3.4.1
registry.aliyuncs.com/google_containers/etcd:3.4.13-0
registry.aliyuncs.com/google_containers/coredns/coredns:v1.8.0
</code></pre></div><p>然后使用docker images可以查看本地的镜像是否包含了上面所有的镜像</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">REPOSITORY                                                        TAG          IMAGE ID       CREATED        SIZE
registry.cn-hangzhou.aliyuncs.com/google_containers/kicbase       v0.0.20      c6f4fc187bc1   <span style="color:#ae81ff">10</span> days ago    1.09GB
registry.aliyuncs.com/google_containers/kube-apiserver            v1.21.0      4d217480042e   <span style="color:#ae81ff">11</span> days ago    126MB
registry.aliyuncs.com/google_containers/kube-proxy                v1.21.0      38ddd85fe90e   <span style="color:#ae81ff">11</span> days ago    122MB
registry.aliyuncs.com/google_containers/kube-controller-manager   v1.21.0      09708983cc37   <span style="color:#ae81ff">11</span> days ago    120MB
registry.aliyuncs.com/google_containers/kube-scheduler            v1.21.0      62ad3129eca8   <span style="color:#ae81ff">11</span> days ago    50.6MB
vesoft/nebula-graphd                                              v2-nightly   ed51f7efd7ee   <span style="color:#ae81ff">3</span> weeks ago    292MB
vesoft/nebula-storaged                                            v2-nightly   efdfb1a1cd3d   <span style="color:#ae81ff">3</span> weeks ago    296MB
vesoft/nebula-metad                                               v2-nightly   bdc1edaa036c   <span style="color:#ae81ff">3</span> weeks ago    296MB
vesoft/nebula-console                                             v2-nightly   ff7f72b06a10   <span style="color:#ae81ff">3</span> weeks ago    14.5MB
hello-world                                                       latest       d1165f221234   <span style="color:#ae81ff">6</span> weeks ago    13.3kB
registry.aliyuncs.com/google_containers/pause                     3.4.1        0f8457a4c2ec   <span style="color:#ae81ff">3</span> months ago   683kB
coredns/coredns                                                   1.8.0        296a6d5035e2   <span style="color:#ae81ff">5</span> months ago   42.5MB
registry.aliyuncs.com/google_containers/coredns/coredns           v1.8.0       296a6d5035e2   <span style="color:#ae81ff">5</span> months ago   42.5MB
registry.aliyuncs.com/google_containers/etcd                      3.4.13-0     0369cf4303ff   <span style="color:#ae81ff">7</span> months ago   253MB
</code></pre></div><p>如果镜像都有，则可以进行下一步</p>
<h4 id="运行kubeadm-init命令安装master节点">运行kubeadm init命令安装master节点</h4>
<p>执行kubeadm init命令可以一键安装kubernetes到master节点</p>
<p>如果需要制定参数，如：安装calico插件时需要指定&ndash;pod-network-cidr=192.168.0.0/16。</p>
<p>接下来使用前面创建的配置文件进行集群控制面的初始化</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubeadm init --config<span style="color:#f92672">=</span>init-config.yaml
</code></pre></div><p>运行前，需要禁用swap分区，可以运行如下命令禁用：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># 注释/etc/fstab关于swap的配置</span>
<span style="color:#75715e"># 然后执行如下命令</span>
echo vm.swappiness<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt; /etc/sysctl.conf 
<span style="color:#75715e"># 重启</span>
reboot
<span style="color:#75715e"># 查看是否禁用</span>
free -m
<span style="color:#75715e"># 如果swap全部是0表示成功</span>
</code></pre></div><p>运行kubeadm init报错如下，没有可以跳过这步：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>init<span style="color:#f92672">]</span> Using Kubernetes version: v1.21.0
<span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Running pre-flight checks
	<span style="color:#f92672">[</span>WARNING IsDockerSystemdCheck<span style="color:#f92672">]</span>: detected <span style="color:#e6db74">&#34;cgroupfs&#34;</span> as the Docker cgroup driver. The recommended driver is <span style="color:#e6db74">&#34;systemd&#34;</span>. Please follow the guide at https://kubernetes.io/docs/setup/cri/
	<span style="color:#f92672">[</span>WARNING Hostname<span style="color:#f92672">]</span>: hostname <span style="color:#e6db74">&#34;node&#34;</span> could not be reached
	<span style="color:#f92672">[</span>WARNING Hostname<span style="color:#f92672">]</span>: hostname <span style="color:#e6db74">&#34;node&#34;</span>: lookup node on 192.168.37.2:53: no such host
error execution phase preflight: <span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Some fatal errors occurred:
	<span style="color:#f92672">[</span>ERROR Port-10259<span style="color:#f92672">]</span>: Port <span style="color:#ae81ff">10259</span> is in use
	<span style="color:#f92672">[</span>ERROR Port-10257<span style="color:#f92672">]</span>: Port <span style="color:#ae81ff">10257</span> is in use
	<span style="color:#f92672">[</span>ERROR FileAvailable--etc-kubernetes-manifests-kube-apiserver.yaml<span style="color:#f92672">]</span>: /etc/kubernetes/manifests/kube-apiserver.yaml already exists
	<span style="color:#f92672">[</span>ERROR FileAvailable--etc-kubernetes-manifests-kube-controller-manager.yaml<span style="color:#f92672">]</span>: /etc/kubernetes/manifests/kube-controller-manager.yaml already exists
	<span style="color:#f92672">[</span>ERROR FileAvailable--etc-kubernetes-manifests-kube-scheduler.yaml<span style="color:#f92672">]</span>: /etc/kubernetes/manifests/kube-scheduler.yaml already exists
	<span style="color:#f92672">[</span>ERROR FileAvailable--etc-kubernetes-manifests-etcd.yaml<span style="color:#f92672">]</span>: /etc/kubernetes/manifests/etcd.yaml already exists
	<span style="color:#f92672">[</span>ERROR Port-10250<span style="color:#f92672">]</span>: Port <span style="color:#ae81ff">10250</span> is in use
<span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> If you know what you are doing, you can make a check non-fatal with <span style="color:#e6db74">`</span>--ignore-preflight-errors<span style="color:#f92672">=</span>...<span style="color:#e6db74">`</span>
To see the stack trace of this error execute with --v<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span> or higher
</code></pre></div><p>提示端口被使用，初始化失败时，可以重启一下kubeadm：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># 初始化失败时，可以重启下</span>
kubeadm reset
</code></pre></div><p>运行kubeadm init卡住并报错，没有可以跳过这步：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">...
<span style="color:#f92672">[</span>wait-control-plane<span style="color:#f92672">]</span> Waiting <span style="color:#66d9ef">for</span> the kubelet to boot up the control plane as static Pods from directory <span style="color:#e6db74">&#34;/etc/kubernetes/manifests&#34;</span>. This can take up to 4m0s
<span style="color:#f92672">[</span>kubelet-check<span style="color:#f92672">]</span> Initial timeout of 40s passed.

	Unfortunately, an error has occurred:
		timed out waiting <span style="color:#66d9ef">for</span> the condition

	This error is likely caused by:
		- The kubelet is not running
		- The kubelet is unhealthy due to a misconfiguration of the node in some way <span style="color:#f92672">(</span>required cgroups disabled<span style="color:#f92672">)</span>

	If you are on a systemd-powered system, you can try to troubleshoot the error with the following commands:
		- <span style="color:#e6db74">&#39;systemctl status kubelet&#39;</span>
		- <span style="color:#e6db74">&#39;journalctl -xeu kubelet&#39;</span>

	Additionally, a control plane component may have crashed or exited when started by the container runtime.
	To troubleshoot, list all containers using your preferred container runtimes CLI.

	Here is one example how you may list all Kubernetes containers running in docker:
		- <span style="color:#e6db74">&#39;docker ps -a | grep kube | grep -v pause&#39;</span>
		Once you have found the failing container, you can inspect its logs with:
		- <span style="color:#e6db74">&#39;docker logs CONTAINERID&#39;</span>

error execution phase wait-control-plane: couldn<span style="color:#960050;background-color:#1e0010">&#39;</span>t initialize a Kubernetes cluster
To see the stack trace of this error execute with --v<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span> or higher
</code></pre></div><p>检查配置，发现配置文件中的advertiseAddress为1.2.3.4，需要修改下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">InitConfiguration</span>
<span style="color:#f92672">localAPIEndpoint</span>:
  <span style="color:#75715e"># 修改ip地址为本机ip地址</span>
  <span style="color:#f92672">advertiseAddress</span>: <span style="color:#ae81ff">192.168.37.150</span>
  <span style="color:#f92672">bindPort</span>: <span style="color:#ae81ff">6443</span>
</code></pre></div><p>然后重启下kubeadm reset，之后重新初始化kubeadm init &ndash;config=init-config.yaml，结果如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>addons<span style="color:#f92672">]</span> Applied essential addon: CoreDNS
<span style="color:#f92672">[</span>addons<span style="color:#f92672">]</span> Applied essential addon: kube-proxy

Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> $HOME/.kube/config

Alternatively, <span style="color:#66d9ef">if</span> you are the root user, you can run:

  export KUBECONFIG<span style="color:#f92672">=</span>/etc/kubernetes/admin.conf

You should now deploy a pod network to the cluster.
Run <span style="color:#e6db74">&#34;kubectl apply -f [podnetwork].yaml&#34;</span> with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join 192.168.37.150:6443 --token abcdef.0123456789abcdef <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--discovery-token-ca-cert-hash sha256:b90b7155024b10d3ff27d91bba2f3caef6fff492f866728b01514ee1ae9bb349
</code></pre></div><p>看到上述结果表示初始化成功</p>
<p>根据提示，需要用普通用户执行如下操作，复制配置文件到home目录</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> $HOME/.kube/config
</code></pre></div><p>这样就成功安装了kubernetes的master节点。但是目前集群内没有可用的node节点，并缺少对容器网络的配置。</p>
<p>提示最后几行信息，其中包含了加入节点指令（kubeadm join）和所需的token</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubeadm join 192.168.37.150:6443 --token abcdef.0123456789abcdef <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--discovery-token-ca-cert-hash sha256:b90b7155024b10d3ff27d91bba2f3caef6fff492f866728b01514ee1ae9bb349
</code></pre></div><p>如果你没有token信息，可以执行如下命令获取：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubeadm token list

TOKEN                     TTL         EXPIRES                     USAGES                   DESCRIPTION                                                EXTRA GROUPS
abcdef.0123456789abcdef   3h          2021-04-21T12:50:13+08:00   authentication,signing   &lt;none&gt;                                                     system:bootstrappers:kubeadm:default-node-token

</code></pre></div><p>此时，可以用kubectl命令验证前面提到的ConfigMap：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl get -n kube-system configmap
Warning: v1 ComponentStatus is deprecated in v1.19+
NAME                 STATUS      MESSAGE                                                                                       ERROR
scheduler            Unhealthy   Get <span style="color:#e6db74">&#34;http://127.0.0.1:10251/healthz&#34;</span>: dial tcp 127.0.0.1:10251: connect: connection refused   
controller-manager   Unhealthy   Get <span style="color:#e6db74">&#34;http://127.0.0.1:10252/healthz&#34;</span>: dial tcp 127.0.0.1:10252: connect: connection refused   
etcd-0               Healthy     <span style="color:#f92672">{</span><span style="color:#e6db74">&#34;health&#34;</span>:<span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">}</span>                                                                             
<span style="color:#f92672">[</span>neyo@bogon ~<span style="color:#f92672">]</span>$ kubectl get -n kube-system configmap
NAME                                 DATA   AGE
coredns                              <span style="color:#ae81ff">1</span>      11m
extension-apiserver-authentication   <span style="color:#ae81ff">6</span>      11m
kube-proxy                           <span style="color:#ae81ff">2</span>      11m
kube-root-ca.crt                     <span style="color:#ae81ff">1</span>      11m
kubeadm-config                       <span style="color:#ae81ff">2</span>      11m
kubelet-config-1.21                  <span style="color:#ae81ff">1</span>      11m
</code></pre></div><h4 id="安装node节点加入集群">安装node节点，加入集群</h4>
<p>在新节点，系统准备和kubernetes yum源的配置过程和master节点一致，在node节点上执行如下安装命令：
yum源</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>kubernetes<span style="color:#f92672">]</span>
name<span style="color:#f92672">=</span>Kubernetes Repository
baseurl<span style="color:#f92672">=</span>http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
gpgcheck<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</code></pre></div><p>安装kubeadm、kubelet</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">yum install kubelet kubeadm --disableexcludes<span style="color:#f92672">=</span>kubernetes
</code></pre></div><p>然后运行如下命令启动docker和kubelet服务，并设置开机自启</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">systemctl enable docker <span style="color:#f92672">&amp;&amp;</span> systemctl start docker
systemctl enable kubelet <span style="color:#f92672">&amp;&amp;</span> systemctl start kubelet
</code></pre></div><p>为kubeadm命令生成配置文件，创建文件join-config.yaml，内容如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kubeadm.k8s.io/v1beta2</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">JoinConfiguration</span>
<span style="color:#f92672">discovery</span>:
  <span style="color:#f92672">bootstrapToken</span>:
    <span style="color:#f92672">apiServerEndpoint</span>: <span style="color:#ae81ff">192.168.37.150</span>:<span style="color:#ae81ff">6443</span>
    <span style="color:#f92672">token</span>: <span style="color:#ae81ff">abcdef.0123456789abcdef</span>
    <span style="color:#f92672">unsafeSkipCAVerification</span>: <span style="color:#66d9ef">true</span>
  <span style="color:#f92672">tlsBootstrapToken</span>: <span style="color:#ae81ff">abcdef.0123456789abcdef</span>
</code></pre></div><p>其中，apiServerEndpoint的值来自master服务器的地址，token和tlsBootstrapToken的值就是kubeadm init成功后最后一行提示信息里的token。</p>
<p>执行kubeadm join命令，将本节点加入集群：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubeadm join --config<span style="color:#f92672">=</span>join-config.yaml
</code></pre></div><p>master节点上的kubelet，默认不参与工作负载，如果希望安装一个单机all-in-one的kubernetes环境，
则可以执行下面的命令（删除node的Label&quot;node-role.kubernetes.io/master&quot;），
让master节点成为一个Node,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl taint nodes --all node-role.kubernetes.io/master-
</code></pre></div><h4 id="安装网络插件">安装网络插件</h4>
<p>执行kubectl get nodes命令，会发现kubernetes提示master为notReady状态，这是因为还没有安装CNI网络插件：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl get nodes
NAME   STATUS     ROLES                  AGE   VERSION
node   NotReady   control-plane,master   24m   v1.21.0
</code></pre></div><p>下面根据提示安装CNI网络插件，对于CNI网络插件，有很多选择，可以参考<a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#pod-network">https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#pod-network</a>说明。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl apply -f &lt;add-on.yaml&gt;
</code></pre></div><p>例如：目前最流行的Kubernetes网络插件有Flannel、Calico、Canal、Weave这里选择使用flannel，部署网络插件flannel</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml

Warning: policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+
podsecuritypolicy.policy/psp.flannel.unprivileged created
clusterrole.rbac.authorization.k8s.io/flannel created
clusterrolebinding.rbac.authorization.k8s.io/flannel created
serviceaccount/flannel created
configmap/kube-flannel-cfg created
daemonset.apps/kube-flannel-ds created
</code></pre></div><p>然后运行kubectl get nodes查看pod状态</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl get nodes

NAME    STATUS   ROLES                  AGE    VERSION
bogon   Ready    &lt;none&gt;                 2m6s   v1.21.0
node    Ready    control-plane,master   21h    v1.21.0
</code></pre></div><p>可以看到状态已经变为Ready了。</p>
<h4 id="验证集群是否安装完成">验证集群是否安装完成</h4>
<p>执行如下命令，查看相关pod是否都正常创建并运行：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl get pods --all-namespaces
</code></pre></div><p>如果有状态错误的pod，可以执行kubectl &ndash;namespace=kube-system describe pod&lt;pod_name&gt;查看错误原因。</p>
<p>记得，如果安装失败，则可以执行kubeadm reset命令将主机恢复原状，重新执行kubeadm init命令，再次进行安装。</p>
<h4 id="测试集群是否可用">测试集群是否可用</h4>
<p>创建一个pod容器，验证是否正常运行</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># 创建一个nginx容器</span>
kubectl create deployment nginx --image<span style="color:#f92672">=</span>nginx
<span style="color:#75715e"># 暴露对外端口</span>
kubectl expose deployment nginx --port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span> --type<span style="color:#f92672">=</span>NodePort
<span style="color:#75715e"># 查看nginx是否正常运行</span>
kubectl get pod,svc

NAME                         READY   STATUS              RESTARTS   AGE
pod/nginx-6799fc88d8-phqfk   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          17s

NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>        AGE
service/kubernetes   ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP        21h
service/nginx        NodePort    10.108.143.57   &lt;none&gt;        80:32711/TCP   7s

<span style="color:#75715e"># 查看 nginx容器运行状态，如果为Running，则表示可以访问</span>
kubectl get pods

NAME                     READY   STATUS    RESTARTS   AGE
nginx-6799fc88d8-phqfk   1/1     Running   <span style="color:#ae81ff">0</span>          2m5s
<span style="color:#75715e"># 在浏览器中访问 192.168.37.151:32711 即可访问nginx服务</span>
<span style="color:#75715e"># 扩容nginx副本到3个</span>
kubectl scale deployment nginx --replicas<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>
kubectl get pods
</code></pre></div><h4 id="部署dashboard">部署dashboard</h4>
<p>略</p>
<h3 id="kubeadm升级集群">kubeadm升级集群</h3>
<p>首先要升级的是kubeadm</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">yum install -y kubeadm-1.22.0 --disableexcludes<span style="color:#f92672">=</span>kubernetes

kubeadm version
</code></pre></div><p>接下来查看kubeadm的升级计划</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubeadm upgrade plan
</code></pre></div><p>按照任务指引进行升级</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubeadm upgrade apply 1.22.0
</code></pre></div><p>输入y确认后，开始进行升级，运行完成之后，再次查看版本</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl version
</code></pre></div><p>查看node版本，发现node版本滞后，对node节点配置进行升级</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubeadm upgrade node config --kubelet-version 1.22.0
</code></pre></div><p><strong>参考文献</strong></p>
<ul>
<li><a href="https://blog.csdn.net/xtjatswc/article/details/109234575">https://blog.csdn.net/xtjatswc/article/details/109234575</a></li>
<li><a href="https://www.cnblogs.com/cptao/p/10912644.html">https://www.cnblogs.com/cptao/p/10912644.html</a></li>
</ul>

        </div>
        <div id="disqus_thread"></div>
<script>

    

    

    (function() { 
        var d = document, s = d.createElement('script');
        s.src = 'https://realjf.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </article>
    

    <div class="article-related">
        <hr/>
        <fieldset>
            <legend>相关阅读推荐（See Also）</legend>
            <ul>
                
                    <li><a href="/k8s/operator-pattern/">k8s 之 Operator模式 Operator Pattern</a></li>
                
                    <li><a href="/k8s/minikube-start/">k8s集群 之一 创建集群 minikube安装使用 Minikube Start</a></li>
                
                    <li><a href="/k8s/k8s-plugins-traefik/">Kubernetes集群下 Traefik安装和使用</a></li>
                
                    <li><a href="/k8s/k8s-core-principle-network-model/">kubernetes 核心原理之 网络模型</a></li>
                
                    <li><a href="/k8s/k8s-core-principle-security/">kubernetes 核心原理之 集群安全机制</a></li>
                
            </ul>
        </fieldset>
    </div>


    
<aside class="aside-menu">
    <div class="aside-bar-icon">
        <i class="fa fa-list-alt"></i>
    </div>
    <ul>
        
        
            
                <li>
                    <a href="/" title="首页">
                        
                        <span>首页</span>
                    </a>
                </li>
            
        
            
                <li>
                    <a href="/posts/" title="归档">
                        
                        <span>归档</span>
                    </a>
                </li>
            
        
            
                <li>
                    <a href="/tags/" title="标签">
                        
                        <span>标签</span>
                    </a>
                </li>
            
        
            
                <li>
                    <a href="/categories/" title="分类">
                        
                        <span>分类</span>
                    </a>
                </li>
            
        
    </ul>
</aside>

    

</main>
    <aside class="sider">
    <div>
        <h2>书籍</h2>
    </div>
    <ul>
        <li>
            <a href="https://premake.realjf.io" title="premake" target="_blank">
                <span>premake 中文手册</span>
            </a>
        </li>
        <li>
            <a href="https://gltf.realjf.io" title="glTF" target="_blank">
                <span>glTF 中文手册</span>
            </a>
        </li>
        <li>
            <a href="https://box2d.realjf.io" title="Box2D" target="_blank">
                <span>Box2D 中文手册</span>
            </a>
        </li>
        <li>
            <a href="https://gdb.realjf.io" title="gdb" target="_blank">
                <span>gdb 中文手册</span>
            </a>
        </li>
    </ul>
</aside>

<div class="app-footer">
    <span>
  powered by <a target="_blank" href="https://gohugo.io">hugo</a> &nbsp;&nbsp;&nbsp;
   &copy; 2019 - 2021 <a href="https://realjf.io">realjf.io</a>
</span>
</div>
<script id="dsq-count-scr" src="//realjf.disqus.com/count.js" async></script>
<script type="text/javascript" src="./js/highlight.min.js"></script>
</body>
</html>
